version: '3'
services:
  samba:
    image: dockurr/samba
    container_name: samba
    hostname: samba
    environment:
      NAME: "Data"
      USER: "samba"
      PASS: "secret"
    ports:
      - 445:445
    volumes:
      - ./samba:/storage
    restart: always
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "445"]
      interval: 30s
      timeout: 10s
      retries: 3

  samba-client:
    image: alpine
    container_name: samba-client
    depends_on:
      samba:
        condition: service_healthy
    volumes:
      - ./scripts:/scripts
    command: sh -c "apk add --no-cache samba-client && tail -f /dev/null"
    restart: unless-stopped
