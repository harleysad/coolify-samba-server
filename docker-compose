version: '3'
services:
  vpn:
    image: hwdsl2/ipsec-vpn-server
    container_name: ipsec-vpn
    restart: always
    environment:
      - VPN_IPSEC_PSK=your_shared_pre_key
      - VPN_USER=seuusuario
      - VPN_PASSWORD=suasenha
      - VPN_PUBLIC_IP=SEU_IP_PUBLICO
    ports:
      - "500:500/udp"
      - "4500:4500/udp"
      - "1701:1701/udp"
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.accept_redirects=0
      - net.ipv4.conf.all.send_redirects=0
    cap_add:
      - NET_ADMIN
      - SYS_MODULE  # Permite carregar módulos do kernel
    volumes:
      - /lib/modules:/lib/modules:ro
      - /run:/run  # Necessário para alguns sistemas
    command: ["--privileged"]  # Adiciona privilégios extras
